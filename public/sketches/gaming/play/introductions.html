<!DOCTYPE html>
<html lang="en" class="grid">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>introductions & a choice</title>
    <link rel="stylesheet" type="text/css" href="./styles_shared.css" />
    <link rel="stylesheet" type="text/css" href="./styles_website.css" />
    <script src="./gameplay.js" defer></script>
    <style>
      .a-choice {
        width: 300px;
        margin: 0;
      }

      .a-linked-choice {
        font-size: unset;
      }

      .island-choice > a,
      .ocean-choice > a {
        color: white;
        text-underline-offset: 3px;
      }

      .island-choice,
      .ocean-choice {
        border: 25px solid blue;
        border-radius: 12.5px;
        padding: 25px;
      }

      .island-choice {
        background-color: sienna;
        color: white;
      }

      .ocean-choice {
        background-color: blue;
        color: white;
      }

      /* tiny override for choice */
      .wave-inverse.bottom-corner {
        border-radius: 0 0 25px 0;
      }
      .wave-inverse.top-corner {
        border-radius: 25px 0 0 0;
      }
    </style>
    <script>
      const initialPositions = {
        "#you": [
          {"x":3,"y":7},
        ],
        "#yes": [
          {"x":7,"y":9},
        ],
        "#hints": [
          {"x":2,"y":2,"center":false},
        ],
        "#i-will-seek": [
          {"x":12,"y":11,"center":false},
        ],
        "#i-will-offer": [
          {"x":12,"y":5,"center":false},
        ],
        ".wave.cell": [
          {"x":0,"y":11},
          {"x":3,"y":8},
          {"x":3,"y":14},
          {"x":13,"y":3},
          {"x":13,"y":16},
          {"x":17,"y":14},
        ],
        ".wave.two-cell-h": [
          {"x":4,"y":0,"center":false},
          {"x":4,"y":12,"center":false},
          {"x":5,"y":6,"center":false},
          {"x":7,"y":14,"center":false},
          {"x":11,"y":12,"center":false},
        ],
        ".wave.three-cell-h": [
          {"x":1,"y":5,"center":false},
          {"x":16,"y":4,"center":false},
        ],
        ".wave.wave-inverse": [
          {"x":12,"y":11,"center":false},
          {"x":18,"y":13,"center":false},
        ],
      }

      const directions = [
        "Would you like to try?",
        "Can you imagine crossing an ocean to meet a stranger?"
      ]

      const state = {
        boundaries: [],
        obstacles: [],
        activeArea: null,
        activeAreas: []
      }
      // point: {x, y}, activation: () => {}, { height, width, center }
      const activeAreasToCreate = [
        {
          point: initialPositions["#yes"][0],
          activation: activateYes,
        }
      ]

      function activateYes() {
        showOrHideSelector("#yes", false)
        showOrHideSelector("#hints", false)
        // Clear existing active areas + obstacles since active elements are hidden
        state.activeAreas = []
        state.obstacles = []
        showOrHideSelectorList(".wave:not(.wave-inverse)", true)
        const seekingArea = createActiveArea(
          { 
            x: initialPositions["#i-will-seek"][0].x - 1,
            y: initialPositions["#i-will-seek"][0].y - 1,
          },
          () => window.location.assign("./start-of-seeking.html"),
          { height: 5, width: 10, center: false },
        )
        const offeringArea = createActiveArea(
          { 
            x: initialPositions["#i-will-offer"][0].x - 1,
            y: initialPositions["#i-will-offer"][0].y - 1,
          },
          () => window.location.assign("./start-of-offering.html"),
          { height: 5, width: 10, center: false },
        )
        const afterTextDisplay = () => {
          showOrHideSelector("#i-will-seek")
          showOrHideSelector("#i-will-offer")
          state.activeAreas.push(seekingArea)
          state.activeAreas.push(offeringArea)
          // TODO: fix weird timing fade issue
          showOrHideSelector(".wave-inverse.top-corner")
          showOrHideSelector(".wave-inverse.bottom-corner")
        }
        const question = stringList(directions[1])
        displayOneByOne(question, { after: afterTextDisplay })
      }

      document.addEventListener("DOMContentLoaded", () => {
        // position elements on grid based on their pre-defined locations
        for (const selector of Object.keys(initialPositions)) {
          const positions = initialPositions[selector]
          positionOnGridBySelector(selector, positions)
        }

        // Set up sounds
        const audio = setUpMainAudio()

        // Add boundary of the page to boundary list
        const sceneBoundary = { startX: 0, startY: 0 }
        state.boundaries.push(sceneBoundary)

        // get the tagged obstacles and record their grid positions
        const obstacles = document.querySelectorAll('[data-obstacle]')
        obstacles.forEach((o) => {
          const { scrollX, scrollY } = window
          const { top, left, width, height } = o.getBoundingClientRect()
          const position = { startX: pixelsToGrid(scrollX + left), startY: pixelsToGrid(scrollY + top) }
          if (width > GRID_SIZE_PX) {
            const widthExceedingCell = width - GRID_SIZE_PX
            position.endX = pixelsToGrid(scrollX + left + widthExceedingCell)
          }

          if (height > GRID_SIZE_PX) {
            const heightExceedingCell = height - GRID_SIZE_PX
            position.endY = pixelsToGrid(scrollY + top + heightExceedingCell)
          }
          state.obstacles.push(position)
        })

        // Create any pre-defined active areas and add them
        // to the global state
        if (activeAreasToCreate && Array.isArray(activeAreasToCreate)) {
          activeAreasToCreate.forEach(area => {
            state.activeAreas.push(
              createActiveArea(area.point, area.activation, area.options)
            )
          })
        }

        // Move the avatar based on arrow presses
        document.addEventListener("keydown", onKeyDown)
      })
    </script>
  </head>
  <body>
    <main>
      <!-- Idea: maybe this would read better if instructions where at top, and the directions could offer the "would you like to try?", then the layout resumes like the normal game when you complete that interaction? -->
      <h1 id="direction">Would you like to try?</h1>
      <section id="hints">
        <p>Use your arrow keys or the controls in the lower right to move <b><u>you</u></b> around the space.</p>
        <p>Elements in the landscape that have text are interactive.</p>
        <p><b><u>You</u></b> can trigger interactive elements by moving next to them or by clicking on them.</p>
        <p>This game is best played on desktop.</p>
      </section>
      <figure id="you" class="cell center">you</figure>
      <button id="yes" class="cell" onclick="activateYes()" data-obstacle>yes</button>
      <p id="i-will-seek" class="a-choice ocean-choice fade hidden-with-fade" data-draggable>
        I'm ready to make a long journey. <br />
        <a href="./start-of-seeking.html" class="a-linked-choice"> I'll seek connection from a stranger offering it.</a>
      </p>
      <p id="i-will-offer" class="a-choice island-choice fade hidden-with-fade" data-draggable>
        That sounds like a long journey to make. <br />
        <a href="./start-of-offering.html" class="a-linked-choice">I'll offer connection to a stranger making the journey.</a>
      </p>

      <!-- waves -->
      <figure class="fade hidden-with-fade wave three-cell-h" data-draggable></figure>
      <figure class="fade hidden-with-fade wave three-cell-h" data-draggable></figure>
      <figure class="fade hidden-with-fade wave two-cell-h" data-draggable></figure>
      <figure class="fade hidden-with-fade wave two-cell-h" data-draggable></figure>
      <figure class="fade hidden-with-fade wave two-cell-h" data-draggable></figure>
      <figure class="fade hidden-with-fade wave two-cell-h" data-draggable></figure>
      <figure class="fade hidden-with-fade wave two-cell-h" data-draggable></figure>
      <figure class="fade hidden-with-fade wave cell" data-draggable></figure>
      <figure class="fade hidden-with-fade wave cell" data-draggable></figure>
      <figure class="fade hidden-with-fade wave cell" data-draggable></figure>
      <figure class="fade hidden-with-fade wave cell" data-draggable></figure>
      <figure class="fade hidden-with-fade wave cell" data-draggable></figure>
      <figure class="fade hidden-with-fade wave cell" data-draggable></figure>
      <figure class="wave wave-inverse three-cell-h top-corner fade hidden-with-fade" data-draggable></figure>
      <figure class="wave wave-inverse two-cell-h bottom-corner fade hidden-with-fade" data-draggable></figure>
    </main>
    <section role="toolbar" class="controls">
      <div>
        <button class="move-direction" onclick="onArrowButtonClick('up')">^</button>
        <button class="move-direction rotate-270" onclick="onArrowButtonClick('left')">^</button>
        <button class="move-direction rotate-90" onclick="onArrowButtonClick('right')">^</button>
        <button class="move-direction rotate-180" onclick="onArrowButtonClick('down')">^</button>
      </div>
      <button class="toggle" onclick="toggleGrid()">toggle grid</button>
      <button class="toggle" onclick="alert('not implemented yet sorry')">hide controls</button>
      <button class="toggle" onclick="printPositions()">print (dev)</button>
    </section>
    <div class="veil disappear" aria-hidden></div>
    <!-- TODO: Remove after dev is complete -->
    <!-- <script src="../draggable.js" defer></script> -->
  </body>
</html>